<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vai Dar Maré!</title>
    <link rel="manifest" href="/manifest.json">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playwrite+DE+SAS:wght@100..400&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a fonte Oswald como padrão para o body, exceto onde 'cursive-title' é aplicado */
        body {
            font-family: 'Oswald', sans-serif;
            background-color: #001F4F; /* Azul Profundo: Fundo da página */
        }
        /* Estilos adicionais para botões e cards */
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(5px); /* Menos blur para leveza */
            background-color: rgba(255, 255, 255, 1);
            border: 1px solid rgba(229, 231, 235, 0.6);
        }
        /* CLASSE CURSIVA EXPRESSIVA */
        .cursive-title {
            font-family: 'Playwrite DE SAS', cursive;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Nova Paleta de Cores
                        'page-bg': '#001F4F', // Azul Profundo - Fundo e Botão Principal
                        'title-color': '#004C99', // Azul Médio - Títulos
                        'card-bg': '#F8FAFC', // Azul Gelo - Fundo do Container de Resultados
                        'tide-high': '#4A90E2', // Azul Claro - Maré Alta
                        'tide-low': '#3C9B50', // Verde Mar - Maré Baixa
                    },
                    fontFamily: {
                        sans: ['Oswald', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex items-start justify-center pt-8 pb-4 px-4">

    <div class="w-full max-w-lg card rounded-xl p-6 md:p-8">
        
        <div class="flex flex-col items-center mt-4 mb-4">
            <img src="icon-192x192.png" class="w-32 md:w-40" alt="Logo Vai Dar Maré: Símbolo de ondas em tons de azul">

            <h2 class="cursive-title text-4xl font-extrabold text-title-color mt-2">
                Vai Dar Maré!
            </h2>
        </div>
        
        <form id="tideForm" class="space-y-4">
            
            <p class="text-sm font-medium text-gray-700 text-center py-2">
                Tábua das Marés de Natal/RN.
            </p>

            <div>
                <label for="dateInput" class="block text-sm font-medium text-gray-700">Data</label>
                <input type="date" id="dateInput" required 
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-title-color focus:border-title-color transition duration-150 ease-in-out">
            </div>

            <button type="submit" id="submitBtn" 
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white bg-page-bg hover:bg-title-color focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-title-color transition duration-300 ease-in-out transform hover:scale-[1.01]">
                <span id="btnText">Consultar</span>
                <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </form>

        <div id="resultsContainer" class="mt-6 pt-4 pb-6 px-4 rounded-xl bg-card-bg border border-gray-200 min-h-[100px] flex flex-col items-center justify-center transition-all duration-300">

            <p id="message" class="text-gray-500 text-center">Insira a data para consultar a tábua.</p>
            <div id="tideList" class="w-full mt-4 space-y-3 hidden">
                </div>
        </div>
        
        <p class="mt-6 text-xs text-center text-gray-400">Dados fornecidos pela Diretoria de Hidrografia e Navegação (DHN).</p>
        <p class="mt-1 text-xs text-center text-gray-500 font-bold">Horários exibidos em GMT -3 (Hora de Natal/RN).</p>
    </div>

    <script>
        // === DADOS OFICIAIS DE MARÉ (NOVEMBRO/DEZEMBRO 2025) ===
        // Fonte: Porto de Natal - Capitania dos Portos do RN
        // Fuso Horário: UTC-03.0 horas (Hora de Natal/RN)
        // OBS: Os dados negativos de altura referem-se a marés mais baixas que o nível de referência oficial (LAT).
        const TIDE_DATA_2025 = {
            // === NOVEMBRO 2025 ===
            "2025-11-01": [
                { "type": "high", "time": "00:40", "height": 2.01 },
                { "type": "low", "time": "06:51", "height": 0.52 },
                { "type": "high", "time": "13:17", "height": 2.03 },
                { "type": "low", "time": "19:12", "height": 0.58 }
            ],
            "2025-11-02": [
                { "type": "high", "time": "01:28", "height": 1.96 },
                { "type": "low", "time": "07:37", "height": 0.59 },
                { "type": "high", "time": "14:02", "height": 1.96 },
                { "type": "low", "time": "19:57", "height": 0.64 }
            ],
            "2025-11-03": [
                { "type": "high", "time": "02:18", "height": 1.88 },
                { "type": "low", "time": "08:24", "height": 0.67 },
                { "type": "high", "time": "14:48", "height": 1.87 },
                { "type": "low", "time": "20:46", "height": 0.70 }
            ],
            "2025-11-04": [
                { "type": "high", "time": "03:12", "height": 1.77 },
                { "type": "low", "time": "09:15", "height": 0.75 },
                { "type": "high", "time": "15:37", "height": 1.76 },
                { "type": "low", "time": "21:40", "height": 0.76 }
            ],
            "2025-11-05": [
                { "type": "high", "time": "04:14", "height": 1.66 },
                { "type": "low", "time": "10:13", "height": 0.82 },
                { "type": "high", "time": "16:32", "height": 1.63 },
                { "type": "low", "time": "22:42", "height": 0.82 }
            ],
            "2025-11-06": [
                { "type": "high", "time": "05:27", "height": 1.57 },
                { "type": "low", "time": "11:21", "height": 0.85 },
                { "type": "high", "time": "17:35", "height": 1.53 },
                { "type": "low", "time": "23:53", "height": 0.85 }
            ],
            "2025-11-07": [
                { "type": "low", "time": "12:35", "height": 0.84 },
                { "type": "high", "time": "06:47", "height": 1.55 },
                { "type": "high", "time": "18:47", "height": 1.50 }
            ],
            "2025-11-08": [
                { "type": "high", "time": "01:08", "height": 1.48 },
                { "type": "low", "time": "08:14", "height": 0.58 },
                { "type": "low", "time": "13:46", "height": 0.79 },
                { "type": "high", "time": "20:01", "height": 1.60 }
            ],
            "2025-11-09": [
                { "type": "high", "time": "02:14", "height": 1.68 },
                { "type": "low", "time": "09:10", "height": 0.38 },
                { "type": "low", "time": "14:46", "height": 0.70 },
                { "type": "high", "time": "21:05", "height": 1.83 }
            ],
            "2025-11-10": [
                { "type": "high", "time": "03:10", "height": 1.92 },
                { "type": "low", "time": "10:01", "height": 0.17 },
                { "type": "low", "time": "15:38", "height": 0.58 },
                { "type": "high", "time": "21:59", "height": 2.06 }
            ],
            "2025-11-11": [
                { "type": "high", "time": "03:59", "height": 2.15 },
                { "type": "low", "time": "10:48", "height": 0.00 },
                { "type": "low", "time": "16:24", "height": 0.47 },
                { "type": "high", "time": "22:47", "height": 2.26 }
            ],
            "2025-11-12": [
                { "type": "high", "time": "04:43", "height": 2.34 },
                { "type": "low", "time": "11:32", "height": -0.11 },
                { "type": "low", "time": "17:08", "height": 0.38 },
                { "type": "high", "time": "23:31", "height": 2.42 }
            ],
            "2025-11-13": [
                { "type": "high", "time": "05:25", "height": 2.50 },
                { "type": "low", "time": "12:14", "height": -0.18 },
                { "type": "low", "time": "17:50", "height": 0.32 }
            ],
            "2025-11-14": [
                { "type": "high", "time": "00:13", "height": 2.54 },
                { "type": "low", "time": "12:55", "height": -0.21 },
                { "type": "high", "time": "06:05", "height": 2.61 },
                { "type": "low", "time": "18:31", "height": 0.28 }
            ],
            "2025-11-15": [
                { "type": "high", "time": "00:54", "height": 2.62 },
                { "type": "low", "time": "13:36", "height": -0.20 },
                { "type": "high", "time": "06:44", "height": 2.66 },
                { "type": "low", "time": "19:12", "height": 0.28 }
            ],
            "2025-11-16": [
                { "type": "high", "time": "01:34", "height": 2.65 },
                { "type": "low", "time": "14:17", "height": -0.16 },
                { "type": "high", "time": "07:23", "height": 2.66 },
                { "type": "low", "time": "19:54", "height": 0.31 }
            ],
            "2025-11-17": [
                { "type": "high", "time": "02:15", "height": 2.64 },
                { "type": "low", "time": "14:59", "height": -0.09 },
                { "type": "high", "time": "08:02", "height": 2.62 },
                { "type": "low", "time": "20:38", "height": 0.36 }
            ],
            "2025-11-18": [
                { "type": "high", "time": "02:58", "height": 2.58 },
                { "type": "low", "time": "15:43", "height": 0.00 },
                { "type": "high", "time": "08:44", "height": 2.54 },
                { "type": "low", "time": "21:26", "height": 0.44 }
            ],
            "2025-11-19": [
                { "type": "high", "time": "03:45", "height": 2.49 },
                { "type": "low", "time": "16:30", "height": 0.12 },
                { "type": "high", "time": "09:30", "height": 2.44 },
                { "type": "low", "time": "22:19", "height": 0.54 }
            ],
            "2025-11-20": [
                { "type": "high", "time": "04:36", "height": 2.37 },
                { "type": "low", "time": "17:21", "height": 0.25 },
                { "type": "high", "time": "10:25", "height": 2.31 },
                { "type": "low", "time": "23:20", "height": 0.65 }
            ],
            "2025-11-21": [
                { "type": "high", "time": "05:37", "height": 2.25 },
                { "type": "low", "time": "18:18", "height": 0.38 },
                { "type": "high", "time": "11:30", "height": 2.18 }
            ],
            "2025-11-22": [
                { "type": "low", "time": "00:30", "height": 0.76 },
                { "type": "low", "time": "19:20", "height": 0.50 },
                { "type": "high", "time": "06:51", "height": 2.18 },
                { "type": "high", "time": "12:51", "height": 2.08 }
            ],
            "2025-11-23": [
                { "type": "low", "time": "01:46", "height": 0.85 },
                { "type": "low", "time": "20:25", "height": 0.60 },
                { "type": "high", "time": "08:24", "height": 2.21 },
                { "type": "high", "time": "14:19", "height": 2.05 }
            ],
            "2025-11-24": [
                { "type": "low", "time": "03:07", "height": 0.90 },
                { "type": "low", "time": "21:30", "height": 0.68 },
                { "type": "high", "time": "09:47", "height": 2.33 },
                { "type": "high", "time": "15:37", "height": 2.11 }
            ],
            "2025-11-25": [
                { "type": "low", "time": "04:23", "height": 0.90 },
                { "type": "low", "time": "22:30", "height": 0.74 },
                { "type": "high", "time": "10:53", "height": 2.50 },
                { "type": "high", "time": "16:40", "height": 2.24 }
            ],
            "2025-11-26": [
                { "type": "low", "time": "05:27", "height": 0.85 },
                { "type": "low", "time": "23:25", "height": 0.77 },
                { "type": "high", "time": "11:47", "height": 2.66 },
                { "type": "high", "time": "17:34", "height": 2.40 }
            ],
            "2025-11-27": [
                { "type": "low", "time": "06:23", "height": 0.77 },
                { "type": "high", "time": "12:35", "height": 2.79 },
                { "type": "high", "time": "18:24", "height": 2.56 }
            ],
            "2025-11-28": [
                { "type": "high", "time": "00:15", "height": 2.78 },
                { "type": "low", "time": "07:14", "height": 0.67 },
                { "type": "high", "time": "13:20", "height": 2.87 },
                { "type": "low", "time": "19:11", "height": 0.74 }
            ],
            "2025-11-29": [
                { "type": "high", "time": "01:03", "height": 2.71 },
                { "type": "low", "time": "08:02", "height": 0.58 },
                { "type": "high", "time": "14:04", "height": 2.88 },
                { "type": "low", "time": "19:55", "height": 0.71 }
            ],
            "2025-11-30": [
                { "type": "high", "time": "01:49", "height": 2.70 },
                { "type": "low", "time": "08:48", "height": 0.52 },
                { "type": "high", "time": "14:48", "height": 2.83 },
                { "type": "low", "time": "20:39", "height": 0.70 }
            ],
            // === DEZEMBRO 2025 ===
            "2025-12-01": [
                { "type": "high", "time": "02:34", "height": 2.66 },
                { "type": "low", "time": "09:34", "height": 0.49 },
                { "type": "high", "time": "15:32", "height": 2.74 },
                { "type": "low", "time": "21:23", "height": 0.71 }
            ],
            "2025-12-02": [
                { "type": "high", "time": "03:19", "height": 2.59 },
                { "type": "low", "time": "10:18", "height": 0.49 },
                { "type": "high", "time": "16:16", "height": 2.62 },
                { "type": "low", "time": "22:07", "height": 0.74 }
            ],
            "2025-12-03": [
                { "type": "high", "time": "04:05", "height": 2.49 },
                { "type": "low", "time": "11:04", "height": 0.52 },
                { "type": "high", "time": "17:01", "height": 2.49 },
                { "type": "low", "time": "22:53", "height": 0.79 }
            ],
            "2025-12-04": [
                { "type": "high", "time": "04:54", "height": 2.37 },
                { "type": "low", "time": "11:53", "height": 0.57 },
                { "type": "high", "time": "17:49", "height": 2.35 },
                { "type": "low", "time": "23:42", "height": 0.85 }
            ],
            "2025-12-05": [
                { "type": "high", "time": "05:48", "height": 2.24 },
                { "type": "low", "time": "12:47", "height": 0.63 },
                { "type": "high", "time": "18:43", "height": 2.21 }
            ],
            "2025-12-06": [
                { "type": "low", "time": "00:36", "height": 0.90 },
                { "type": "low", "time": "13:48", "height": 0.69 },
                { "type": "high", "time": "06:53", "height": 2.12 },
                { "type": "high", "time": "19:44", "height": 2.09 }
            ],
            "2025-12-07": [
                { "type": "low", "time": "01:38", "height": 0.92 },
                { "type": "low", "time": "14:58", "height": 0.73 },
                { "type": "high", "time": "08:12", "height": 2.07 },
                { "type": "high", "time": "20:53", "height": 2.01 }
            ],
            "2025-12-08": [
                { "type": "low", "time": "02:51", "height": 0.91 },
                { "type": "low", "time": "16:11", "height": 0.74 },
                { "type": "high", "time": "09:32", "height": 2.11 },
                { "type": "high", "time": "22:01", "height": 2.01 }
            ],
            "2025-12-09": [
                { "type": "low", "time": "04:02", "height": 0.85 },
                { "type": "low", "time": "17:15", "height": 0.70 },
                { "type": "high", "time": "10:43", "height": 2.25 },
                { "type": "high", "time": "22:58", "height": 2.09 }
            ],
            "2025-12-10": [
                { "type": "low", "time": "05:03", "height": 0.77 },
                { "type": "low", "time": "18:11", "height": 0.63 },
                { "type": "high", "time": "11:39", "height": 2.45 },
                { "type": "high", "time": "23:45", "height": 2.22 }
            ],
            "2025-12-11": [
                { "type": "low", "time": "05:54", "height": 0.69 },
                { "type": "low", "time": "18:59", "height": 0.53 },
                { "type": "high", "time": "12:28", "height": 2.65 }
            ],
            "2025-12-12": [
                { "type": "high", "time": "00:27", "height": 2.37 },
                { "type": "low", "time": "06:37", "height": 0.60 },
                { "type": "low", "time": "19:42", "height": 0.44 },
                { "type": "high", "time": "13:14", "height": 2.80 }
            ],
            "2025-12-13": [
                { "type": "high", "time": "01:07", "height": 2.52 },
                { "type": "low", "time": "07:18", "height": 0.53 },
                { "type": "low", "time": "20:23", "height": 0.38 },
                { "type": "high", "time": "13:56", "height": 2.91 }
            ],
            "2025-12-14": [
                { "type": "high", "time": "01:45", "height": 2.65 },
                { "type": "low", "time": "07:56", "height": 0.48 },
                { "type": "low", "time": "21:03", "height": 0.35 },
                { "type": "high", "time": "14:36", "height": 2.97 }
            ],
            "2025-12-15": [
                { "type": "high", "time": "02:22", "height": 2.76 },
                { "type": "low", "time": "08:34", "height": 0.45 },
                { "type": "low", "time": "21:42", "height": 0.34 },
                { "type": "high", "time": "15:15", "height": 2.97 }
            ],
            "2025-12-16": [
                { "type": "high", "time": "02:59", "height": 2.83 },
                { "type": "low", "time": "09:11", "height": 0.44 },
                { "type": "low", "time": "22:21", "height": 0.35 },
                { "type": "high", "time": "15:53", "height": 2.93 }
            ],
            "2025-12-17": [
                { "type": "high", "time": "03:36", "height": 2.86 },
                { "type": "low", "time": "09:47", "height": 0.45 },
                { "type": "low", "time": "23:01", "height": 0.38 },
                { "type": "high", "time": "16:32", "height": 2.85 }
            ],
            "2025-12-18": [
                { "type": "high", "time": "04:14", "height": 2.84 },
                { "type": "low", "time": "10:24", "height": 0.49 },
                { "type": "low", "time": "23:42", "height": 0.43 },
                { "type": "high", "time": "17:12", "height": 2.74 }
            ],
            "2025-12-19": [
                { "type": "high", "time": "04:54", "height": 2.78 },
                { "type": "low", "time": "11:02", "height": 0.55 },
                { "type": "high", "time": "17:54", "height": 2.61 }
            ],
            "2025-12-20": [
                { "type": "low", "time": "00:25", "height": 0.50 },
                { "type": "low", "time": "11:43", "height": 0.63 },
                { "type": "high", "time": "05:37", "height": 2.67 },
                { "type": "high", "time": "18:38", "height": 2.47 }
            ],
            "2025-12-21": [
                { "type": "low", "time": "01:12", "height": 0.59 },
                { "type": "low", "time": "12:27", "height": 0.72 },
                { "type": "high", "time": "06:24", "height": 2.53 },
                { "type": "high", "time": "19:28", "height": 2.34 }
            ],
            "2025-12-22": [
                { "type": "low", "time": "02:07", "height": 0.69 },
                { "type": "low", "time": "13:18", "height": 0.81 },
                { "type": "high", "time": "07:20", "height": 2.37 },
                { "type": "high", "time": "20:26", "height": 2.22 }
            ],
            "2025-12-23": [
                { "type": "low", "time": "03:13", "height": 0.80 },
                { "type": "low", "time": "14:18", "height": 0.88 },
                { "type": "high", "time": "08:33", "height": 2.25 },
                { "type": "high", "time": "21:37", "height": 2.15 }
            ],
            "2025-12-24": [
                { "type": "low", "time": "04:31", "height": 0.88 },
                { "type": "low", "time": "15:32", "height": 0.92 },
                { "type": "high", "time": "10:13", "height": 2.24 },
                { "type": "high", "time": "22:56", "height": 2.18 }
            ],
            "2025-12-25": [
                { "type": "low", "time": "05:49", "height": 0.90 },
                { "type": "low", "time": "16:47", "height": 0.92 },
                { "type": "high", "time": "11:32", "height": 2.38 }
            ],
            "2025-12-26": [
                { "type": "high", "time": "00:13", "height": 2.29 },
                { "type": "low", "time": "06:56", "height": 0.87 },
                { "type": "low", "time": "17:53", "height": 0.88 },
                { "type": "high", "time": "12:35", "height": 2.58 }
            ],
            "2025-12-27": [
                { "type": "high", "time": "01:17", "height": 2.44 },
                { "type": "low", "time": "07:54", "height": 0.80 },
                { "type": "low", "time": "18:48", "height": 0.82 },
                { "type": "high", "time": "13:28", "height": 2.76 }
            ],
            "2025-12-28": [
                { "type": "high", "time": "02:12", "height": 2.62 },
                { "type": "low", "time": "08:45", "height": 0.70 },
                { "type": "low", "time": "19:37", "height": 0.75 },
                { "type": "high", "time": "14:15", "height": 2.89 }
            ],
            "2025-12-29": [
                { "type": "high", "time": "03:01", "height": 2.78 },
                { "type": "low", "time": "09:33", "height": 0.60 },
                { "type": "low", "time": "20:23", "height": 0.67 },
                { "type": "high", "time": "14:59", "height": 2.97 }
            ],
            "2025-12-30": [
                { "type": "high", "time": "03:46", "height": 2.90 },
                { "type": "low", "time": "10:18", "height": 0.52 },
                { "type": "low", "time": "21:07", "height": 0.60 },
                { "type": "high", "time": "15:42", "height": 2.99 }
            ],
            "2025-12-31": [
                { "type": "high", "time": "04:29", "height": 2.96 },
                { "type": "low", "time": "11:01", "height": 0.46 },
                { "type": "low", "time": "21:50", "height": 0.54 },
                { "type": "high", "time": "16:25", "height": 2.97 }
            ]
        };
        // =========================================

        // === REGISTRO DO SERVICE WORKER (PWA) ===
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // NOTE: Se você estava usando o arquivo service-worker.js antigo, lembre-se de atualizá-lo 
                // para remover a regra de exclusão do cache para /api/tide, se ainda não o fez, 
                // ou apenas deixar a versão atual.
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('SW registrado com sucesso. Escopo:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Falha no registro do SW:', error);
                    });
            });
        }
        // =========================================

        const form = document.getElementById('tideForm');
        const dateInput = document.getElementById('dateInput');
        const resultsContainer = document.getElementById('resultsContainer');
        const message = document.getElementById('message');
        const tideList = document.getElementById('tideList');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const loadingSpinner = document.getElementById('loadingSpinner'); 

        // Funções de Utilidade
        function getTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }
        
        function showLoading(show) {
            submitBtn.disabled = show;
            btnText.classList.toggle('hidden', show); 
            loadingSpinner.classList.toggle('hidden', !show);
            
            if (show) {
                tideList.classList.add('hidden');
                tideList.innerHTML = '';
            }
        }

        function showError(msg) {
            message.textContent = msg;
            message.classList.remove('hidden'); 
            // Estilo de erro
            resultsContainer.classList.remove('bg-card-bg', 'bg-tide-high/20', 'border-tide-high/50', 'bg-yellow-100', 'border-yellow-400');
            resultsContainer.classList.add('bg-red-100', 'border-red-400');
            tideList.classList.add('hidden');
            showLoading(false); 
        }
        
        // A hora já está no fuso correto (GMT -3) no JSON, apenas formatamos a string.
        const formatTime = (timeString) => {
            // O tempo já vem no formato HH:MM (ex: "00:40")
            if (timeString && timeString.length === 5) {
                return timeString; 
            }
            return 'N/A';
        };

        // Função para exibir os dados na lista - Adaptada para JSON Local
        const displayTideData = (tideEvents) => {
            
            let resultsHtml = `
                <h2 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-2 text-title-color">Natal/RN - Tábua Oficial</h2>
            `; 

            resultsHtml += `<div class="w-full mt-4 space-y-3">`;

            tideEvents.forEach(event => {
                // O JSON local usa "high" e "low"
                const isHighTide = event.type === 'high'; 
                const icon = isHighTide ? '▲' : '▼';
                
                // Classes Tailwind customizadas
                const color = isHighTide ? 'text-tide-high' : 'text-tide-low';
                const borderColor = isHighTide ? 'border-tide-high/50' : 'border-tide-low/50';
                const label = isHighTide ? 'Maré Alta' : 'Maré Baixa';
                
                // A altura já é a final e correta (em metros)
                const height = event.height.toFixed(2); 

                resultsHtml += `
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white border shadow-sm ${borderColor}">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl font-bold ${color}">${icon}</span>
                            <div>
                                <p class="font-medium text-gray-900">${label}</p>
                                <p class="text-xs text-gray-500">Altura: ${height}m</p>
                            </div>
                        </div>
                        <span class="text-lg font-bold text-gray-700">${formatTime(event.time)}</span>
                    </div>
                `;
            });

            resultsHtml += `</div>`; 
            tideList.innerHTML = resultsHtml;

            message.textContent = '';
            message.classList.add('hidden');
            tideList.classList.remove('hidden');
            // Estilo de sucesso
            resultsContainer.classList.remove('bg-card-bg', 'bg-red-100', 'bg-yellow-100', 'border-red-400', 'border-yellow-400');
            resultsContainer.classList.add('bg-tide-high/20', 'border-tide-high/50');
        };


        // Lógica da Consulta
        async function fetchTideData(dateString) {
            showLoading(true);
            message.textContent = 'Buscando dados...';
            message.classList.remove('hidden'); 

            // Estilo de busca
            resultsContainer.classList.remove('bg-red-100', 'border-red-400', 'bg-tide-high/20', 'border-tide-high/50', 'bg-yellow-100', 'border-yellow-400');
            resultsContainer.classList.add('bg-card-bg', 'border-gray-300');

            try {
                // Simula uma busca assíncrona (opcional, apenas para dar a sensação de loading)
                await new Promise(resolve => setTimeout(resolve, 300)); 
                
                // Busca o array de eventos de maré pela chave da data (YYYY-MM-DD)
                const tideEvents = TIDE_DATA_2025[dateString]; 

                if (tideEvents && tideEvents.length > 0) {
                    displayTideData(tideEvents);
                } else {
                    // Se não houver dados para a data selecionada
                    message.textContent = 'Sem dados de tábua para esta data.';
                    message.classList.remove('hidden');
                    tideList.classList.add('hidden');
                    // Estilo de aviso
                    resultsContainer.classList.remove('bg-card-bg', 'bg-tide-high/20', 'border-tide-high/50');
                    resultsContainer.classList.add('bg-yellow-100', 'border-yellow-400');
                }

            } catch (error) {
                console.error('Erro na busca de dados locais:', error);
                showError('Erro interno ao ler a tábua de marés.');
            } finally {
                showLoading(false);
            }
        }


        // Listener do Formulário (CORRIGIDO PARA O FORMATO DE DATA YYYY-MM-DD)
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            let dateString = dateInput.value;
            
            // --- VERIFICAÇÃO DE FORMATO CRÍTICA ---
            // Garante que a string tenha o formato YYYY-MM-DD e é válida.
            if (!dateString || !/\d{4}-\d{2}-\d{2}/.test(dateString)) {
                showError("Formato de data inválido. Por favor, selecione uma data no calendário.");
                return;
            }
            
            // Adiciona uma verificação de ano, já que os dados são apenas para 2025
            if (!dateString.startsWith('2025')) {
                showError("A tábua de marés está disponível apenas para Novembro e Dezembro de 2025.");
                return;
            }

            if (dateString) {
                fetchTideData(dateString); 
            }
        });

        // Inicialização: Define a data de hoje por padrão
        window.onload = () => {
            dateInput.value = getTodayDate();
        };
    </script>
</body>
</html>
