<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>T√°bua de Mar√©s - QWeather API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef6ff;
      color: #222;
      text-align: center;
      padding: 20px;
    }
    h1 { color: #0050a0; }
    .day {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 15px;
      margin: 15px auto;
      max-width: 600px;
    }
    .api-url {
      font-size: 0.9em;
      color: #333;
      background: #dfefff;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 20px;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <h1>T√°bua de Mar√©s - Natal/RN üåä</h1>
  <div class="api-url" id="apiUrl"></div>
  <div id="content">Carregando dados...</div>

  <script>
    const baseUrl = "https://ky33jp8fv5.re.qweatherapi.com/v7/ocean/tide";
    const location = "P2902";
    const key = "77b43510d8844b3ab3eb6e30392f3b2a";
    const proxy = "https://api.allorigins.win/raw?url=";

    // Fun√ß√£o para converter UTC em hora local
    function utcToLocal(utcTime) {
      const date = new Date(utcTime + "Z");
      return date.toLocaleString("pt-BR", { timeZoneName: "short" });
    }

    // Fun√ß√£o principal
    async function carregarTabelas() {
      const hoje = new Date();
      const datas = [
        hoje.toISOString().slice(0,10).replace(/-/g, ""),
        new Date(hoje.getTime() + 86400000).toISOString().slice(0,10).replace(/-/g, "")
      ];

      const content = document.getElementById("content");
      const apiUrlDiv = document.getElementById("apiUrl");
      apiUrlDiv.textContent = `${baseUrl}?location=${location}&date=${datas[0]}&key=${key}`;

      let html = "";

      for (const data of datas) {
        const apiUrl = `${baseUrl}?location=${location}&date=${data}&key=${key}`;
        const fullUrl = proxy + encodeURIComponent(apiUrl);

        try {
          const resp = await fetch(fullUrl);
          if (!resp.ok) throw new Error("Erro HTTP");
          const json = await resp.json();

          html += `<div class="day"><h2>${data.slice(6,8)}/${data.slice(4,6)}/${data.slice(0,4)}</h2>`;
          if (json.tideTable && json.tideTable.length > 0) {
            html += "<table style='margin:auto'><tr><th>Hora Local</th><th>N√≠vel (cm)</th></tr>";
            for (const mar of json.tideTable) {
              html += `<tr><td>${utcToLocal(mar.time)}</td><td>${mar.height} cm</td></tr>`;
            }
            html += "</table>";
          } else {
            html += "<p>Sem dados dispon√≠veis.</p>";
          }
          html += "</div>";
        } catch (err) {
          html += `<p>Erro ao acessar dados de ${data}: ${err.message}</p>`;
        }
      }
      content.innerHTML = html;
    }

    carregarTabelas();
  </script>
</body>
</html>
